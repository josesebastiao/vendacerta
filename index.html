<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>VendaCerta | Calculadora Premium</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --primary: #22c55e;
      --secondary: #0f172a;
      --bg-dark: #020617;
      --text-light: #f8fafc;
      --card-bg: #ffffff;
    }

    * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    
    body { margin: 0; background: #f1f5f9; color: #1e293b; overflow-x: hidden; }

    /* =========================================
       TELA DE VENDAS (DESIGN PREMIUM)
       ========================================= */
    #lockScreen {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
      color: white;
      padding: 20px;
      position: relative;
      z-index: 9999;
    }

    /* Efeito de Vidro no Card de Vendas */
    .glass-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px;
      padding: 40px 24px;
      max-width: 480px;
      width: 100%;
      text-align: center;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .logo-area { margin-bottom: 24px; }
    .logo-area i { font-size: 48px; color: var(--primary); filter: drop-shadow(0 0 15px rgba(34, 197, 94, 0.4)); }
    
    .lock-content h1 { 
      font-size: 2.2rem; margin: 0 0 12px 0; letter-spacing: -0.02em;
      background: linear-gradient(to right, #ffffff, #94a3b8);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    
    .lock-content p { color: #94a3b8; font-size: 1.05rem; line-height: 1.6; margin-bottom: 32px; }

    /* Bot√£o WhatsApp Correto (Link Tag) */
    .btn-buy {
      display: flex; align-items: center; justify-content: center; gap: 10px;
      background: var(--primary); color: #020617;
      padding: 18px 32px; border-radius: 16px;
      font-weight: 800; text-decoration: none; font-size: 1.1rem;
      width: 100%; margin-bottom: 30px;
      box-shadow: 0 0 20px rgba(34, 197, 94, 0.3);
      transition: transform 0.2s, box-shadow 0.2s;
      animation: pulse 2s infinite;
    }
    .btn-buy:active { transform: scale(0.96); }

    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
      100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }

    /* Grid de Benef√≠cios */
    .features-grid {
      display: grid; grid-template-columns: 1fr 1fr; gap: 12px;
      text-align: left;
    }
    .feature-item {
      background: rgba(255,255,255,0.05); padding: 12px 16px; 
      border-radius: 12px; font-size: 0.85rem; color: #cbd5e1;
      display: flex; align-items: center; gap: 8px;
    }
    .feature-item i { color: var(--primary); }

    /* =========================================
       APLICATIVO (CALCULADORA)
       ========================================= */
    #app { display: none; max-width: 600px; margin: 0 auto; padding: 20px 20px 100px 20px; }
    
    header { text-align: center; margin-bottom: 25px; margin-top: 10px; }
    header h2 { margin: 0; color: var(--secondary); font-size: 1.5rem; }
    
    .card { background: white; border-radius: 20px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05); }

    /* Inputs e Selects */
    .input-group { margin-bottom: 16px; }
    .input-group label { display: block; font-size: 0.85rem; font-weight: 700; color: #475569; margin-bottom: 6px; }
    
    .input-wrapper { position: relative; }
    .input-wrapper span { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: #94a3b8; font-weight: 500; }
    
    input, select {
      width: 100%; padding: 14px; border-radius: 12px; border: 1px solid #e2e8f0;
      font-size: 1rem; color: var(--secondary); outline: none; background: #fff;
      transition: all 0.2s;
    }
    .money-input { padding-left: 40px; } /* Espa√ßo para o R$ */
    
    input:focus, select:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.1); }

    /* Plataformas */
    .platform-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
    .p-btn {
      padding: 12px; border: 1px solid #e2e8f0; border-radius: 12px; background: #f8fafc;
      cursor: pointer; font-weight: 600; color: #64748b; text-align: center;
      transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 8px;
    }
    .p-btn.active { border-color: var(--primary); background: #f0fdf4; color: var(--primary); box-shadow: 0 4px 6px -1px rgba(34, 197, 94, 0.1); }
    
    /* Bot√£o Calcular */
    .btn-calc {
      width: 100%; background: var(--secondary); color: white; padding: 16px;
      border-radius: 14px; border: none; font-size: 1.1rem; font-weight: 700;
      margin-top: 10px; cursor: pointer; box-shadow: 0 10px 20px rgba(15, 23, 42, 0.15);
    }
    .btn-calc:active { transform: scale(0.98); }

    /* Resultados */
    #results { display: none; margin-top: 25px; border-top: 2px dashed #e2e8f0; padding-top: 25px; animation: slideUp 0.4s ease; }
    .price-display { text-align: center; margin-bottom: 20px; }
    .price-display h1 { margin: 5px 0; font-size: 2.5rem; color: var(--secondary); letter-spacing: -1px; }
    
    .profit-badge {
      display: inline-block; background: #dcfce7; color: #166534; padding: 6px 16px;
      border-radius: 20px; font-weight: 700; font-size: 0.9rem;
    }
    .profit-badge.negative { background: #fee2e2; color: #991b1b; }

    .details-grid { background: #f8fafc; padding: 16px; border-radius: 12px; display: grid; gap: 12px; }
    .detail-row { display: flex; justify-content: space-between; font-size: 0.9rem; color: #64748b; }
    .detail-row strong { color: #334155; }

    /* PAINEL ADMIN MELHORADO */
    #adminPanel { 
      display: none; background: #fff; padding: 24px; margin-top: 30px; 
      border: 2px dashed #cbd5e1; border-radius: 16px; 
    }
    .admin-input-group { margin-bottom: 15px; }
    .copy-btn {
      background: #3b82f6; color: white; border: none; padding: 8px 16px;
      border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.85rem;
      margin-top: 5px; display: inline-block;
    }

    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

  <div id="lockScreen">
    <div class="glass-card">
      <div class="logo-area">
        <i class="fa-solid fa-calculator"></i>
      </div>
      
      <div class="lock-content">
        <h1>VendaCerta</h1>
        <p>Pare de perder dinheiro com taxas erradas. <br>Tenha a precifica√ß√£o exata na palma da m√£o.</p>
        
        <a href="https://wa.me/5527999553035?text=Ol√°,%20quero%20liberar%20meu%20acesso%20ao%20VendaCerta!" 
           class="btn-buy" 
           target="_blank">
           QUERO ACESSAR AGORA <i class="fa-brands fa-whatsapp"></i>
        </a>

        <div class="features-grid">
          <div class="feature-item"><i class="fa-solid fa-check-circle"></i> Shopee, ML, Amazon</div>
          <div class="feature-item"><i class="fa-solid fa-check-circle"></i> C√°lculo de Lucro Real</div>
          <div class="feature-item"><i class="fa-solid fa-check-circle"></i> Acesso Vital√≠cio</div>
          <div class="feature-item"><i class="fa-solid fa-check-circle"></i> Funciona Offline</div>
        </div>
      </div>
    </div>
  </div>

  <div id="app">
    <header>
      <h2>Calculadora de Pre√ßo</h2>
    </header>

    <div class="card">
      
      <label style="font-size: 0.85rem; font-weight: 700; color: #475569; margin-bottom: 10px; display:block;">Selecione a Plataforma</label>
      <div class="platform-selector">
        <div class="p-btn active" onclick="setPlatform('shopee')" data-platform="shopee">
          <i class="fa-solid fa-bag-shopping"></i> Shopee
        </div>
        <div class="p-btn" onclick="setPlatform('ml')" data-platform="ml">
          <i class="fa-solid fa-handshake"></i> M. Livre
        </div>
        <div class="p-btn" onclick="setPlatform('amazon')" data-platform="amazon">
          <i class="fa-brands fa-amazon"></i> Amazon
        </div>
        <div class="p-btn" onclick="setPlatform('magalu')" data-platform="magalu">
          <i class="fa-solid fa-store"></i> Magalu
        </div>
      </div>

      <div id="dynamicOptions" style="margin-bottom: 15px;"></div>

      <div class="input-group">
        <label>Custo do Produto + Embalagem</label>
        <div class="input-wrapper">
          <span>R$</span>
          <input type="number" id="custo" class="money-input" placeholder="0,00" step="0.01">
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
        <div class="input-group">
          <label>Margem Lucro (%)</label>
          <input type="number" id="margem" placeholder="30" value="30">
        </div>
        <div class="input-group">
          <label>Imposto N.F. (%)</label>
          <input type="number" id="imposto" placeholder="4" value="4">
        </div>
      </div>

      <div class="input-group" id="freteContainer" style="display:none;">
        <label>Custo Frete (Pago por voc√™)</label>
        <div class="input-wrapper">
          <span>R$</span>
          <input type="number" id="frete" class="money-input" placeholder="0,00" value="0">
        </div>
        <small style="color: #64748b; font-size: 0.75rem;">Obrigat√≥rio p/ ML acima de R$ 79,00</small>
      </div>

      <button class="btn-calc" onclick="calcular()">CALCULAR PRE√áO IDEAL</button>

      <div id="results">
        <div class="price-display">
          <small>Venda por este pre√ßo:</small>
          <h1 id="resPreco">R$ 0,00</h1>
          <div id="badgeLucro" class="profit-badge">Lucro: R$ 0,00</div>
        </div>

        <div class="details-grid">
          <div class="detail-row">
            <span>Taxa da Plataforma</span>
            <strong id="resTaxas">R$ 0,00</strong>
          </div>
          <div class="detail-row">
            <span>Impostos (NF)</span>
            <strong id="resImposto">R$ 0,00</strong>
          </div>
          <div class="detail-row">
            <span>Custo Produto</span>
            <strong id="resCusto">R$ 0,00</strong>
          </div>
          <div class="detail-row" id="rowFrete" style="display:none;">
            <span>Frete Gr√°tis</span>
            <strong id="resFrete">R$ 0,00</strong>
          </div>
        </div>
      </div>
    </div>

    <div id="adminPanel">
      <h3 style="margin-top:0">üëë Gerador de Acesso</h3>
      
      <div class="admin-input-group">
        <label>1. Nome do Cliente (Token):</label>
        <input type="text" id="tokenName" placeholder="Ex: PEDRO" onkeyup="generateLink()">
      </div>
      
      <div class="admin-input-group">
        <label>2. Copie este link e envie:</label>
        <input type="text" id="finalLink" readonly style="background: #f1f5f9; color: #64748b;">
        <button onclick="copyLink()" class="copy-btn"><i class="fa-regular fa-copy"></i> Copiar Link</button>
      </div>
    </div>

    <footer style="text-align: center; margin-top: 40px; font-size: 0.8rem; color: #94a3b8;">
      <p>Desenvolvido por <strong>Sebastec</strong></p>
    </footer>
  </div>

  <script>
    // === 1. DADOS DAS TAXAS (2025) ===
    const FEES = {
      shopee: {
        padrao: { comm: 14, fixed: 3.00 },
        frete_gratis: { comm: 20, fixed: 3.00 }
      },
      ml: {
        classico: { comm: 11.5, fixed: 6.00 }, 
        premium: { comm: 16.5, fixed: 6.00 }
      },
      amazon: {
        individual: { comm: 15, fixed: 2.00 },
        profissional: { comm: 15, fixed: 0.00 }
      },
      magalu: {
        padrao: { comm: 16, fixed: 3.00 }
      }
    };

    // === 2. CONFIGURA√á√ÉO DE ACESSO ===
    // ADICIONE AQUI OS NOMES DOS SEUS CLIENTES
    const VALID_TOKENS = ["ADMIN", "LIBERADO123", "CLIENTEVIP", "TESTE", "AMIGO"];
    
    let currentPlatform = 'shopee';
    const urlParams = new URLSearchParams(window.location.search);
    const userToken = urlParams.get('token');

    // === 3. VERIFICA√á√ÉO INICIAL ===
    function checkAccess() {
      // Se for Admin, libera tudo e mostra painel
      if (userToken === 'ADMIN') {
        document.getElementById('lockScreen').style.display = 'none';
        document.getElementById('app').style.display = 'block';
        document.getElementById('adminPanel').style.display = 'block';
        generateLink(); // Inicia o gerador
        return;
      }

      // Se for Cliente V√°lido, libera s√≥ o app
      if (VALID_TOKENS.includes(userToken)) {
        document.getElementById('lockScreen').style.display = 'none';
        document.getElementById('app').style.display = 'block';
      } 
      // Se n√£o tiver token, continua bloqueado na tela inicial
    }

    // === 4. UI E C√ÅLCULOS ===
    function setPlatform(p) {
      currentPlatform = p;
      
      // Visual dos bot√µes
      document.querySelectorAll('.p-btn').forEach(btn => btn.classList.remove('active'));
      document.querySelector(`.p-btn[data-platform="${p}"]`).classList.add('active');

      // Op√ß√µes din√¢micas
      const opts = document.getElementById('dynamicOptions');
      const freteInput = document.getElementById('freteContainer');
      opts.innerHTML = '';
      freteInput.style.display = 'none';

      if (p === 'shopee') {
        opts.innerHTML = `
          <select id="subOption">
            <option value="padrao">Padr√£o (14% + R$3)</option>
            <option value="frete_gratis">Prog. Frete Gr√°tis (20% + R$3)</option>
          </select>`;
      } else if (p === 'ml') {
        opts.innerHTML = `
          <select id="subOption">
            <option value="classico">Cl√°ssico (~11.5%)</option>
            <option value="premium">Premium (~16.5%)</option>
          </select>`;
        freteInput.style.display = 'block';
      } else if (p === 'amazon') {
        opts.innerHTML = `
          <select id="subOption">
            <option value="individual">Plano Individual (+R$ 2,00)</option>
            <option value="profissional">Plano Profissional</option>
          </select>`;
      }
    }

    function calcular() {
      const custo = parseFloat(document.getElementById('custo').value);
      const margem = parseFloat(document.getElementById('margem').value);
      const imposto = parseFloat(document.getElementById('imposto').value) || 0;
      
      if (!custo || !margem) {
        alert("Preencha o Custo e a Margem de Lucro");
        return;
      }

      let subOption = document.getElementById('subOption') ? document.getElementById('subOption').value : 'padrao';
      let commPct = 0;
      let fixedFee = 0;
      let freteSeller = 0;

      // Buscar Taxas
      if (currentPlatform === 'shopee') {
        commPct = FEES.shopee[subOption].comm;
        fixedFee = FEES.shopee[subOption].fixed;
      } 
      else if (currentPlatform === 'ml') {
        commPct = FEES.ml[subOption].comm;
        
        // L√≥gica ML: Se usu√°rio digitou frete, usa o frete e zera taxa fixa
        const freteInput = parseFloat(document.getElementById('frete').value) || 0;
        if (freteInput > 0) {
          freteSeller = freteInput;
          fixedFee = 0; 
        } else {
          fixedFee = FEES.ml[subOption].fixed; 
        }
      }
      else if (currentPlatform === 'amazon') {
        commPct = FEES.amazon[subOption].comm;
        fixedFee = FEES.amazon[subOption].fixed;
      }
      else if (currentPlatform === 'magalu') {
        commPct = FEES.magalu.padrao.comm;
        fixedFee = FEES.magalu.padrao.fixed;
      }

      // C√°lculo Reverso
      const lucroDesejado = custo * (margem / 100);
      const numerador = custo + lucroDesejado + fixedFee + freteSeller;
      const divisor = 1 - ((commPct + imposto) / 100);

      if (divisor <= 0) {
        alert("Taxas muito altas! Imposs√≠vel ter lucro.");
        return;
      }

      const precoFinal = numerador / divisor;
      
      // Detalhamento final
      const valorComissao = precoFinal * (commPct / 100);
      const valorImposto = precoFinal * (imposto / 100);
      const totalTaxas = valorComissao + fixedFee + valorImposto + freteSeller;
      const lucroReal = precoFinal - custo - totalTaxas;

      // Exibi√ß√£o
      document.getElementById('resPreco').innerText = formatMoney(precoFinal);
      document.getElementById('badgeLucro').innerText = `Lucro L√≠quido: ${formatMoney(lucroReal)}`;
      document.getElementById('badgeLucro').className = lucroReal > 0 ? 'profit-badge' : 'profit-badge negative';
      
      document.getElementById('resTaxas').innerText = formatMoney(valorComissao + fixedFee);
      document.getElementById('resImposto').innerText = formatMoney(valorImposto);
      document.getElementById('resCusto').innerText = formatMoney(custo);

      // Mostrar frete se houver
      const rowFrete = document.getElementById('rowFrete');
      if (freteSeller > 0) {
        rowFrete.style.display = 'flex';
        document.getElementById('resFrete').innerText = formatMoney(freteSeller);
      } else {
        rowFrete.style.display = 'none';
      }

      document.getElementById('results').style.display = 'block';

      // Alerta ML > 79
      if (currentPlatform === 'ml' && precoFinal > 79 && freteSeller === 0) {
        alert("Aten√ß√£o: Para vendas acima de R$ 79,00 no Mercado Livre, o frete √© por sua conta. Insira o valor do frete para o c√°lculo ficar correto.");
      }
    }

    function formatMoney(n) {
      return n.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    }

    // === 5. FUN√á√ïES DO ADMIN (GERADOR DE LINKS) ===
    function generateLink() {
      const baseUrl = window.location.href.split('?')[0];
      const name = document.getElementById('tokenName').value.trim().toUpperCase() || "CLIENTE";
      const finalUrl = `${baseUrl}?token=${name}`;
      document.getElementById('finalLink').value = finalUrl;
    }

    function copyLink() {
      const copyText = document.getElementById("finalLink");
      copyText.select();
      copyText.setSelectionRange(0, 99999); // Mobile
      navigator.clipboard.writeText(copyText.value);
      alert("Link copiado: " + copyText.value);
    }

    // Iniciar
    checkAccess();
    setPlatform('shopee');
  </script>
</body>
</html>