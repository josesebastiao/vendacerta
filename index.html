<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>VendaCerta</title>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#020617">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="VendaCerta">
  
  <link rel="apple-touch-icon" href="icon-192.png">

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --primary: #22c55e;
      --secondary: #0f172a;
      --bg-dark: #020617;
      --card-bg: #ffffff;
      /* Área segura para iPhones com Notch */
      --safe-area-bottom: env(safe-area-inset-bottom);
    }

    * { 
      box-sizing: border-box; 
      font-family: 'Inter', sans-serif; 
      -webkit-tap-highlight-color: transparent; /* Remove flash azul no toque */
    }
    
    body { 
      margin: 0; 
      background: #f1f5f9; 
      color: #1e293b; 
      overflow-x: hidden;
      overscroll-behavior-y: none; /* Evita o "puxar para atualizar" do Chrome */
      user-select: none; /* Sensação de App (não seleciona texto) */
    }

    /* Input pode ser selecionável */
    input, select, textarea, .selectable { user-select: text; }

    /* ================= TELA DE BLOQUEIO ================= */
    #lockScreen {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      min-height: 100vh;
      background: radial-gradient(circle at center, #1e293b 0%, #020617 100%);
      color: white; padding: 20px;
      position: relative; z-index: 9999;
    }

    .glass-card {
      background: rgba(255, 255, 255, 0.03);
      backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 24px; padding: 40px 24px;
      width: 100%; max-width: 400px; text-align: center;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
    }

    .btn-buy {
      display: flex; align-items: center; justify-content: center; gap: 10px;
      background: var(--primary); color: #020617;
      padding: 16px; border-radius: 16px;
      font-weight: 800; text-decoration: none; font-size: 1.1rem;
      width: 100%; margin-bottom: 25px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); }
      70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
      100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
    }

    .features-grid { display: grid; grid-template-columns: 1fr; gap: 10px; text-align: left; }
    .feature-item { 
      background: rgba(255,255,255,0.05); padding: 12px; border-radius: 10px; 
      font-size: 0.9rem; color: #cbd5e1; display: flex; align-items: center; gap: 10px; 
    }

    /* ================= APP PRINCIPAL ================= */
    #app { 
      display: none; max-width: 600px; margin: 0 auto; 
      padding: 20px 20px calc(20px + var(--safe-area-bottom)) 20px; /* Padding extra p/ iPhone */
    }
    
    header { text-align: center; margin-bottom: 20px; margin-top: 10px; }
    
    .card { background: white; border-radius: 24px; padding: 24px 20px; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.05); }

    .input-group label { font-size: 0.85rem; font-weight: 700; color: #475569; margin-bottom: 8px; display: block; }
    
    input, select {
      width: 100%; padding: 16px; border-radius: 14px; border: 1px solid #e2e8f0;
      font-size: 16px; /* Evita zoom no iOS */
      color: var(--secondary); outline: none; background: #fff; appearance: none;
    }
    .money-input { padding-left: 45px; }
    .input-wrapper span { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; font-weight: 600; }
    .input-wrapper { position: relative; }

    /* Plataformas - Botões Maiores para Toque */
    .platform-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px; }
    .p-btn {
      padding: 16px 10px; border: 1px solid #e2e8f0; border-radius: 16px; background: #f8fafc;
      cursor: pointer; font-weight: 600; color: #64748b; display: flex; flex-direction: column; 
      align-items: center; justify-content: center; gap: 8px; transition: all 0.2s;
    }
    .p-btn i { font-size: 1.2rem; margin-bottom: 2px; }
    .p-btn.active { border-color: var(--primary); background: #f0fdf4; color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15); }
    
    .btn-calc {
      width: 100%; background: var(--secondary); color: white; padding: 18px;
      border-radius: 16px; border: none; font-size: 1.1rem; font-weight: 700;
      margin-top: 15px; cursor: pointer;
    }

    #results { display: none; margin-top: 30px; border-top: 2px dashed #e2e8f0; padding-top: 30px; animation: slideUp 0.4s ease; }
    
    /* Painel Admin */
    #adminPanel { margin-top: 40px; padding: 20px; background: #fff; border-radius: 16px; border: 2px dashed #cbd5e1; }
    
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>
<div class="logo-area" style="margin-bottom: 20px;">
  <svg width="100" height="100" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 10px 20px rgba(34,197,94,0.3));">
    <rect width="100" height="100" rx="24" fill="#22c55e"/>
    <path d="M25 65L40 50L55 65L75 40" stroke="#020617" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M70 40H75V46" stroke="#020617" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="30" cy="30" r="5" fill="#020617" fill-opacity="0.2"/>
    <circle cx="70" cy="70" r="5" fill="#020617" fill-opacity="0.2"/>
  </svg>
</div>

  <div id="app">
   <header style="display: flex; flex-direction: column; align-items: center; margin-bottom: 25px;">
  <svg width="180" height="50" viewBox="0 0 180 50" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect x="0" y="5" width="40" height="40" rx="10" fill="#22c55e"/>
    <path d="M10 28L16 22L22 28L30 18" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M28 18H30V20" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M12 35H28" stroke="white" stroke-width="2" stroke-linecap="round" stroke-opacity="0.5"/>
    
    <text x="50" y="32" font-family="'Inter', sans-serif" font-weight="800" font-size="22" fill="#0f172a">Venda<tspan fill="#22c55e">Certa</tspan></text>
  </svg>
  
  <p style="color: #64748b; font-size: 0.9rem; margin-top: 5px;">Calculadora Premium</p>
</header>
    <div class="card">
      <div class="platform-selector">
        <div class="p-btn active" onclick="setPlatform('shopee')" data-platform="shopee">
          <i class="fa-solid fa-bag-shopping"></i> Shopee
        </div>
        <div class="p-btn" onclick="setPlatform('ml')" data-platform="ml">
          <i class="fa-solid fa-handshake"></i> M. Livre
        </div>
        <div class="p-btn" onclick="setPlatform('amazon')" data-platform="amazon">
          <i class="fa-brands fa-amazon"></i> Amazon
        </div>
        <div class="p-btn" onclick="setPlatform('magalu')" data-platform="magalu">
          <i class="fa-solid fa-store"></i> Magalu
        </div>
      </div>

      <div id="dynamicOptions" style="margin-bottom: 20px;"></div>

      <div class="input-group">
        <label>Custo Produto + Emb.</label>
        <div class="input-wrapper">
          <span>R$</span><input type="number" id="custo" class="money-input" placeholder="0,00" step="0.01">
        </div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
        <div class="input-group">
          <label>Margem (%)</label><input type="number" id="margem" placeholder="30" value="30">
        </div>
        <div class="input-group">
          <label>Imposto (%)</label><input type="number" id="imposto" placeholder="4" value="4">
        </div>
      </div>

      <div class="input-group" id="freteContainer" style="display:none; margin-top: 15px;">
        <label>Custo Frete (Seller)</label>
        <div class="input-wrapper">
          <span>R$</span><input type="number" id="frete" class="money-input" placeholder="0,00">
        </div>
      </div>

      <button class="btn-calc" onclick="calcular()">CALCULAR</button>

      <div id="results">
        <div style="text-align: center; margin-bottom: 20px;">
          <small style="color:#64748b">Preço de Venda</small>
          <h1 id="resPreco" style="font-size: 2.5rem; color:#0f172a; margin: 5px 0;">R$ 0,00</h1>
          <span id="badgeLucro" style="background:#dcfce7; color:#166534; padding: 5px 15px; border-radius: 20px; font-weight:700; font-size:0.9rem;">Lucro: R$ 0,00</span>
        </div>
        <div style="background:#f8fafc; padding:15px; border-radius:15px; display:grid; gap:10px; font-size:0.9rem; color:#64748b;">
          <div style="display:flex; justify-content:space-between;"><span>Taxas</span><strong id="resTaxas" style="color:#334155">R$ 0,00</strong></div>
          <div style="display:flex; justify-content:space-between;"><span>Imposto</span><strong id="resImposto" style="color:#334155">R$ 0,00</strong></div>
          <div style="display:flex; justify-content:space-between;"><span>Custo</span><strong id="resCusto" style="color:#334155">R$ 0,00</strong></div>
          <div id="rowFrete" style="display:none; justify-content:space-between;"><span>Frete</span><strong id="resFrete" style="color:#334155">R$ 0,00</strong></div>
        </div>
      </div>
    </div>

    <div id="adminPanel" style="display:none;">
      <h3>Painel Admin</h3>
      <input type="text" id="tokenName" placeholder="Nome do Cliente" onkeyup="generateLink()" style="margin-bottom:10px;">
      <input type="text" id="finalLink" readonly onclick="copyLink()" style="background:#f1f5f9; color:#64748b;">
    </div>

    <footer style="text-align: center; margin-top: 40px; color: #94a3b8; font-size: 0.8rem;">VendaCerta Mobile v3.0</footer>
  </div>

  <script>
    // === SERVICE WORKER (PWA) ===
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('SW registrado!', reg))
          .catch(err => console.log('SW falhou:', err));
      });
    }

    // === LÓGICA DO APP (Mesma de antes) ===
    const FEES={shopee:{padrao:{comm:14,fixed:3},frete_gratis:{comm:20,fixed:3}},ml:{classico:{comm:11.5,fixed:6},premium:{comm:16.5,fixed:6}},amazon:{individual:{comm:15,fixed:2},profissional:{comm:15,fixed:0}},magalu:{padrao:{comm:16,fixed:3}}};
    const VALID_TOKENS=["ADMIN","LIBERADO123","CLIENTEVIP","TESTE"];
    let currentPlatform='shopee';
    
    // Check Acesso
    const urlParams=new URLSearchParams(window.location.search);
    const userToken=urlParams.get('token');
    if(userToken==='ADMIN'){
      document.getElementById('lockScreen').style.display='none';
      document.getElementById('app').style.display='block';
      document.getElementById('adminPanel').style.display='block';
      generateLink();
    } else if(VALID_TOKENS.includes(userToken)){
      document.getElementById('lockScreen').style.display='none';
      document.getElementById('app').style.display='block';
    }

    function setPlatform(p){
      currentPlatform=p;
      document.querySelectorAll('.p-btn').forEach(b=>b.classList.remove('active'));
      document.querySelector(`.p-btn[data-platform="${p}"]`).classList.add('active');
      const opts=document.getElementById('dynamicOptions');
      const frete=document.getElementById('freteContainer');
      opts.innerHTML=''; frete.style.display='none';
      
      if(p==='shopee'){
        opts.innerHTML=`<select id="subOption"><option value="padrao">Padrão (14% + R$3)</option><option value="frete_gratis">Frete Grátis (20% + R$3)</option></select>`;
      } else if(p==='ml'){
        opts.innerHTML=`<select id="subOption"><option value="classico">Clássico (~11.5%)</option><option value="premium">Premium (~16.5%)</option></select>`;
        frete.style.display='block';
      } else if(p==='amazon'){
        opts.innerHTML=`<select id="subOption"><option value="individual">Individual (+R$ 2,00)</option><option value="profissional">Profissional</option></select>`;
      }
    }

    function calcular(){
      const custo=parseFloat(document.getElementById('custo').value);
      const margem=parseFloat(document.getElementById('margem').value);
      const imposto=parseFloat(document.getElementById('imposto').value)||0;
      if(!custo||!margem) return alert("Preencha Custo e Margem");
      
      let sub=document.getElementById('subOption')?document.getElementById('subOption').value:'padrao';
      let comm=0, fixed=0, fSeller=0;
      
      if(currentPlatform==='shopee'){comm=FEES.shopee[sub].comm;fixed=FEES.shopee[sub].fixed;}
      else if(currentPlatform==='ml'){
        comm=FEES.ml[sub].comm;
        const fInput=parseFloat(document.getElementById('frete').value)||0;
        if(fInput>0){fSeller=fInput;fixed=0;}else{fixed=FEES.ml[sub].fixed;}
      }
      else if(currentPlatform==='amazon'){comm=FEES.amazon[sub].comm;fixed=FEES.amazon[sub].fixed;}
      else if(currentPlatform==='magalu'){comm=FEES.magalu.padrao.comm;fixed=FEES.magalu.padrao.fixed;}

      const num=custo+(custo*(margem/100))+fixed+fSeller;
      const div=1-((comm+imposto)/100);
      if(div<=0) return alert("Taxas muito altas");
      
      const preco=num/div;
      const tax=preco*(comm/100)+fixed+fSeller;
      const taxImp=preco*(imposto/100);
      const lucro=preco-custo-tax-taxImp;

      document.getElementById('resPreco').innerText=preco.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      document.getElementById('badgeLucro').innerText=`Lucro: ${lucro.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}`;
      document.getElementById('badgeLucro').style.background=lucro>0?'#dcfce7':'#fee2e2';
      document.getElementById('badgeLucro').style.color=lucro>0?'#166534':'#991b1b';
      
      document.getElementById('resTaxas').innerText=tax.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      document.getElementById('resImposto').innerText=taxImp.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      document.getElementById('resCusto').innerText=custo.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      
      const rf=document.getElementById('rowFrete');
      if(fSeller>0){rf.style.display='flex';document.getElementById('resFrete').innerText=fSeller.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});}
      else{rf.style.display='none';}
      
      document.getElementById('results').style.display='block';
    }

    function generateLink(){
      const n=document.getElementById('tokenName').value.trim().toUpperCase()||"CLIENTE";
      document.getElementById('finalLink').value=`${window.location.href.split('?')[0]}?token=${n}`;
    }
    function copyLink(){
      const c=document.getElementById('finalLink');
      c.select(); navigator.clipboard.writeText(c.value); alert("Link copiado!");
    }

    setPlatform('shopee');
  </script>
</body>
</html>