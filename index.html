<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <title>VendaCerta 2026 | Precificação Exata</title>
  
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#020617">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  
  <link rel="apple-touch-icon" href="icon-192.png">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    :root {
      --primary: #22c55e;
      --secondary: #0f172a;
      --bg-dark: #020617;
      --card-bg: #ffffff;
      --safe-area-bottom: env(safe-area-inset-bottom);
    }

    * { box-sizing: border-box; font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
    
    body { 
      margin: 0; background: #f1f5f9; color: #1e293b; 
      overflow-x: hidden; overscroll-behavior-y: none; user-select: none; 
    }
    input, select, textarea { user-select: text; }

    /* ================= TELA DE VENDAS ================= */
    #lockScreen {
      display: flex; flex-direction: column; align-items: center; justify-content: flex-start;
      min-height: 100vh;
      background: linear-gradient(180deg, #0f172a 0%, #020617 100%);
      color: white; padding: 20px; overflow-y: auto;
      position: relative; z-index: 9999;
    }

    .sales-container { width: 100%; max-width: 480px; text-align: center; padding-top: 30px; padding-bottom: 40px; }
    .hero-logo { margin-bottom: 20px; animation: float 3s ease-in-out infinite; }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }

    .headline {
      font-size: 2rem; font-weight: 800; line-height: 1.1; margin-bottom: 10px;
      background: linear-gradient(to right, #ffffff, #4ade80);
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    }
    .subheadline { color: #94a3b8; font-size: 1.05rem; margin-bottom: 30px; line-height: 1.5; }

    .pain-card {
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 20px; padding: 24px; margin-bottom: 30px; text-align: left;
    }
    .pain-item { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; font-size: 0.95rem; color: #e2e8f0; }
    .check-green { color: #22c55e; font-size: 1.1rem; }
    .cross-red { color: #ef4444; font-size: 1.1rem; }

    .btn-buy {
      display: flex; align-items: center; justify-content: center; gap: 10px;
      background: var(--primary); color: #020617;
      padding: 18px; border-radius: 16px;
      font-weight: 800; text-decoration: none; font-size: 1.15rem;
      width: 100%; margin-bottom: 15px;
      box-shadow: 0 0 25px rgba(34, 197, 94, 0.4);
      animation: pulse 2s infinite;
      transition: transform 0.2s;
    }
    .btn-buy:active { transform: scale(0.96); }
    @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.7); } 70% { box-shadow: 0 0 0 15px rgba(34, 197, 94, 0); } 100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); } }
    
    .guarantee { font-size: 0.8rem; color: #64748b; margin-bottom: 40px; display: block; }

    /* ================= APP ================= */
    #app { display: none; max-width: 600px; margin: 0 auto; padding: 20px 20px calc(20px + var(--safe-area-bottom)) 20px; }
    .card { background: white; border-radius: 24px; padding: 24px 20px; box-shadow: 0 10px 30px -5px rgba(0,0,0,0.05); }

    .input-group label { font-size: 0.85rem; font-weight: 700; color: #475569; margin-bottom: 8px; display: block; }
    input, select {
      width: 100%; padding: 16px; border-radius: 14px; border: 1px solid #e2e8f0;
      font-size: 16px; color: var(--secondary); outline: none; background: #fff; appearance: none;
    }
    .money-input { padding-left: 45px; }
    .input-wrapper { position: relative; }
    .input-wrapper span { position: absolute; left: 16px; top: 50%; transform: translateY(-50%); color: #94a3b8; font-weight: 600; }

    .platform-selector { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 24px; }
    .p-btn {
      padding: 16px 10px; border: 1px solid #e2e8f0; border-radius: 16px; background: #f8fafc;
      cursor: pointer; font-weight: 600; color: #64748b; display: flex; flex-direction: column; 
      align-items: center; justify-content: center; gap: 8px; transition: all 0.2s;
    }
    .p-btn.active { border-color: var(--primary); background: #f0fdf4; color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(34, 197, 94, 0.15); }
    
    .btn-calc {
      width: 100%; background: var(--secondary); color: white; padding: 18px;
      border-radius: 16px; border: none; font-size: 1.1rem; font-weight: 700;
      margin-top: 15px; cursor: pointer;
    }

    /* Campos de Taxa Abertos */
    .fee-row {
      display: grid; grid-template-columns: 1fr 1fr; gap: 15px; 
      background: #f8fafc; padding: 15px; border-radius: 16px; margin-bottom: 20px;
      border: 1px dashed #cbd5e1;
    }
    .fee-row input { border: 1px solid #d1d5db; background: white; }
    .fee-title { grid-column: 1 / -1; font-size: 0.8rem; color: #64748b; margin-bottom: 5px; display: flex; justify-content: space-between; }
    .fee-edit-hint { color: #22c55e; font-weight: 600; font-size: 0.75rem; }

    .info-toggle {
      text-align: center; margin-top: 15px; cursor: pointer; 
      color: #64748b; font-size: 0.85rem; font-weight: 600;
      display: flex; align-items: center; justify-content: center; gap: 6px;
    }
    #rulesCard {
      display: none; background: #f8fafc; padding: 16px; 
      border-radius: 12px; margin-top: 15px; border: 1px solid #e2e8f0;
      font-size: 0.85rem; color: #475569;
    }
    #results { display: none; margin-top: 25px; border-top: 2px dashed #e2e8f0; padding-top: 25px; animation: slideUp 0.4s ease; }
    #adminPanel { margin-top: 40px; padding: 20px; background: #fff; border-radius: 16px; border: 2px dashed #cbd5e1; }
    @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
  </style>
</head>
<body>

  <div id="lockScreen">
    <div class="sales-container">
      <div class="hero-logo">
        <svg width="80" height="80" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" style="filter: drop-shadow(0 0 20px rgba(34,197,94,0.4));">
          <rect width="100" height="100" rx="24" fill="#22c55e"/>
          <path d="M25 65L40 50L55 65L75 40" stroke="#020617" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M70 40H75V46" stroke="#020617" stroke-width="8" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </div>
      <h1 class="headline">Sua precificação<br>está correta para<br>2026?</h1>
      <p class="subheadline">Use a única calculadora com taxas atualizadas e campos 100% editáveis.</p>
      <div class="pain-card">
        <div class="pain-item"><i class="fa-solid fa-pen-to-square check-green"></i> <strong>Taxas Editáveis</strong></div>
        <div class="pain-item"><i class="fa-solid fa-check-circle check-green"></i> <strong>Shopee R$4,00 (2026)</strong></div>
        <div class="pain-item"><i class="fa-solid fa-check-circle check-green"></i> <strong>ML: Taxa Dinâmica</strong></div>
      </div>
      <a href="https://wa.me/5527999553035?text=Quero%20acessar%20a%20Calculadora" target="_blank" class="btn-buy">
         QUERO ACESSAR AGORA <i class="fa-brands fa-whatsapp"></i>
      </a>
      <footer style="margin-top: 40px; color: #64748b; font-size: 0.8rem;"><p>&copy; 2026 Sebastec.</p></footer>
    </div>
  </div>

  <div id="app">
    <header style="text-align: center; margin-bottom: 25px;">
        <svg width="140" height="40" viewBox="0 0 180 50" fill="none" xmlns="http://www.w3.org/2000/svg">
            <rect x="0" y="5" width="40" height="40" rx="10" fill="#22c55e"/>
            <path d="M10 28L16 22L22 28L30 18" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <path d="M28 18H30V20" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
            <text x="50" y="32" font-family="'Inter', sans-serif" font-weight="800" font-size="22" fill="#0f172a">Venda<tspan fill="#22c55e">Certa</tspan></text>
        </svg>
    </header>

    <div class="card">
      <div class="platform-selector">
        <div class="p-btn active" onclick="setPlatform('shopee')" data-platform="shopee">
          <i class="fa-solid fa-bag-shopping"></i> Shopee
        </div>
        <div class="p-btn" onclick="setPlatform('ml')" data-platform="ml">
          <i class="fa-solid fa-handshake"></i> M. Livre
        </div>
        <div class="p-btn" onclick="setPlatform('amazon')" data-platform="amazon">
          <i class="fa-brands fa-amazon"></i> Amazon
        </div>
        <div class="p-btn" onclick="setPlatform('magalu')" data-platform="magalu">
          <i class="fa-solid fa-store"></i> Magalu
        </div>
      </div>

      <div id="dynamicOptions" style="margin-bottom: 15px;"></div>

      <div class="fee-row">
        <div class="fee-title">
          <span>Taxas Aplicadas</span>
          <span class="fee-edit-hint"><i class="fa-solid fa-pen"></i> Editável</span>
        </div>
        <div class="input-group" style="margin:0">
          <label>Comissão (%)</label>
          <input type="number" id="feeComm" placeholder="0">
        </div>
        <div class="input-group" style="margin:0">
          <label>Fixo (R$)</label>
          <input type="number" id="feeFixed" placeholder="Auto">
        </div>
      </div>

      <div class="input-group">
        <label>Custo Produto + Emb.</label>
        <div class="input-wrapper"><span>R$</span><input type="number" id="custo" class="money-input" placeholder="0,00" step="0.01"></div>
      </div>

      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
        <div class="input-group"><label>Margem (%)</label><input type="number" id="margem" placeholder="30" value="30"></div>
        <div class="input-group"><label>Imposto (%)</label><input type="number" id="imposto" placeholder="4" value="4"></div>
      </div>

      <div class="input-group" id="freteContainer" style="display:none; margin-top: 15px;">
        <label>Custo Frete (Seller)</label>
        <div class="input-wrapper"><span>R$</span><input type="number" id="frete" class="money-input" placeholder="0,00"></div>
      </div>

      <button class="btn-calc" onclick="calcular()">CALCULAR</button>

      <div class="info-toggle" onclick="toggleRules()"><i class="fa-solid fa-circle-question"></i> Entenda o cálculo 2026</div>
      
      <div id="rulesCard">
        <h4><i class="fa-solid fa-robot" style="color:#22c55e"></i> Inteligência da Calculadora:</h4>
        <ul>
          <li><strong>Campos Editáveis:</strong> Os valores de taxa acima são preenchidos automaticamente com o padrão 2026, mas você pode alterá-los livremente.</li>
          <li><strong>Shopee:</strong> Padrão R$ 4,00 fixo.</li>
          <li><strong>Mercado Livre:</strong> Se o campo "Fixo" estiver vazio (Auto), o sistema calcula a taxa dinâmica (R$ 6,25 a R$ 6,75) baseada no preço final.</li>
        </ul>
      </div>

      <div id="results">
        <div style="text-align: center; margin-bottom: 20px;">
          <small style="color:#64748b">Venda por este preço:</small>
          <h1 id="resPreco" style="font-size: 2.5rem; color:#0f172a; margin: 5px 0;">R$ 0,00</h1>
          <span id="badgeLucro" style="background:#dcfce7; color:#166534; padding: 5px 15px; border-radius: 20px; font-weight:700; font-size:0.9rem;">Lucro: R$ 0,00</span>
        </div>
        <div style="background:#f8fafc; padding:15px; border-radius:15px; display:grid; gap:10px; font-size:0.9rem; color:#64748b;">
          <div style="display:flex; justify-content:space-between;"><span>Taxas</span><strong id="resTaxas" style="color:#334155">R$ 0,00</strong></div>
          <div style="display:flex; justify-content:space-between;"><span>Imposto</span><strong id="resImposto" style="color:#334155">R$ 0,00</strong></div>
          <div style="display:flex; justify-content:space-between;"><span>Custo</span><strong id="resCusto" style="color:#334155">R$ 0,00</strong></div>
          <div id="rowFrete" style="display:none; justify-content:space-between;"><span>Frete</span><strong id="resFrete" style="color:#334155">R$ 0,00</strong></div>
        </div>
      </div>
    </div>

    <div id="adminPanel" style="display:none;">
      <h3>Painel Admin</h3>
      <input type="text" id="tokenName" placeholder="Nome" onkeyup="generateLink()" style="margin-bottom:10px; width: 100%; padding: 10px;">
      <input type="text" id="finalLink" readonly onclick="copyLink()" style="background:#f1f5f9; color:#64748b; width: 100%; padding: 10px;">
    </div>

    <footer style="text-align: center; margin-top: 40px; color: #94a3b8; font-size: 0.8rem;"><p>&copy; 2026 Sebastec.</p></footer>
  </div>

  <script>
    if ('serviceWorker' in navigator) { window.addEventListener('load', () => navigator.serviceWorker.register('./sw.js')); }

    const FEES = {
      shopee: { padrao: { comm: 14, fixed: 4.00 }, frete_gratis: { comm: 20, fixed: 4.00 } },
      ml: { classico: { comm: 11.5 }, premium: { comm: 16.5 } },
      amazon: { individual: { comm: 15, fixed: 2.00 }, profissional: { comm: 15, fixed: 0.00 } },
      magalu: { padrao: { comm: 16, fixed: 3.00 } }
    };
    
    const VALID_TOKENS = ["ADMIN", "LIBERADO123", "CLIENTEVIP"];
    let currentPlatform = 'shopee';
    const urlParams = new URLSearchParams(window.location.search);
    const userToken = urlParams.get('token');

    if(userToken==='ADMIN'){ document.getElementById('lockScreen').style.display='none'; document.getElementById('app').style.display='block'; document.getElementById('adminPanel').style.display='block'; generateLink(); } 
    else if(VALID_TOKENS.includes(userToken)){ document.getElementById('lockScreen').style.display='none'; document.getElementById('app').style.display='block'; }

    function toggleRules() {
      const card = document.getElementById('rulesCard');
      card.style.display = (card.style.display === 'none' || card.style.display === '') ? 'block' : 'none';
    }

    function setPlatform(p){
      currentPlatform = p;
      document.querySelectorAll('.p-btn').forEach(b=>b.classList.remove('active'));
      document.querySelector(`.p-btn[data-platform="${p}"]`).classList.add('active');
      
      const opts = document.getElementById('dynamicOptions');
      const frete = document.getElementById('freteContainer');
      opts.innerHTML=''; frete.style.display='none';
      
      // Select HTML Generation
      if(p==='shopee'){ opts.innerHTML=`<select id="subOption" onchange="updateFees()"><option value="padrao">Padrão</option><option value="frete_gratis">Frete Grátis</option></select>`; } 
      else if(p==='ml'){ opts.innerHTML=`<select id="subOption" onchange="updateFees()"><option value="classico">Clássico</option><option value="premium">Premium</option></select>`; frete.style.display='block'; } 
      else if(p==='amazon'){ opts.innerHTML=`<select id="subOption" onchange="updateFees()"><option value="individual">Individual</option><option value="profissional">Profissional</option></select>`; }
      
      updateFees(); // Preenche os inputs com o padrão
    }

    function updateFees() {
      let sub = document.getElementById('subOption') ? document.getElementById('subOption').value : 'padrao';
      let commInput = document.getElementById('feeComm');
      let fixedInput = document.getElementById('feeFixed');

      if(currentPlatform === 'shopee') {
        commInput.value = FEES.shopee[sub].comm;
        fixedInput.value = FEES.shopee[sub].fixed;
      } else if (currentPlatform === 'ml') {
        commInput.value = FEES.ml[sub].comm;
        fixedInput.value = ""; // Deixa vazio para indicar 'Auto'
      } else if (currentPlatform === 'amazon') {
        commInput.value = FEES.amazon[sub].comm;
        fixedInput.value = FEES.amazon[sub].fixed;
      } else if (currentPlatform === 'magalu') {
        commInput.value = FEES.magalu.padrao.comm;
        fixedInput.value = FEES.magalu.padrao.fixed;
      }
    }

    function calcular(){
      const custo = parseFloat(document.getElementById('custo').value);
      const margem = parseFloat(document.getElementById('margem').value);
      const imposto = parseFloat(document.getElementById('imposto').value) || 0;
      
      // PEGA OS VALORES DOS INPUTS ABERTOS
      let comm = parseFloat(document.getElementById('feeComm').value) || 0;
      let fixedVal = document.getElementById('feeFixed').value; // Pega string para checar se está vazio
      let fixed = parseFloat(fixedVal) || 0;
      
      let fSeller = parseFloat(document.getElementById('frete').value) || 0;

      if(!custo || !margem) return alert("Preencha Custo e Margem");

      // === CÁLCULO GERAL ===
      // Se for ML e o campo fixo estiver VAZIO, calcula dinâmico.
      // Se tiver valor, usa o valor (Override).
      let isMLAuto = (currentPlatform === 'ml' && fixedVal === ""); 
      
      // Estimativa inicial para ML Auto
      if (isMLAuto) fixed = 6.75; 

      let numerator = custo + (custo * (margem / 100)) + fixed + fSeller;
      let divisor = 1 - ((comm + imposto) / 100);
      
      if(divisor <= 0) return alert("Taxas excedem 100%");
      let preco = numerator / divisor;

      // Refinamento ML Auto
      if (isMLAuto && fSeller === 0) {
        if(preco < 29) fixed = 6.25;
        else if(preco < 50) fixed = 6.50;
        else if(preco < 79) fixed = 6.75;
        else { fixed = 0; alert("Passou de R$79. Insira o custo do frete grátis."); }
        
        // Recalcula com a taxa correta
        numerator = custo + (custo * (margem / 100)) + fixed + fSeller;
        preco = numerator / divisor;
      }

      // Detalhamento
      let taxTotal = (preco * (comm / 100)) + fixed + fSeller;
      
      // Ajuste Mínimo Amazon (Se não foi editado manualmente)
      if (currentPlatform === 'amazon' && taxTotal < (1.00 + fixed) && fixedVal !== "") {
         // Lógica simples: se o usuário digitou a taxa, confiamos nele. 
         // Se fosse automático, aplicaríamos a regra de R$1. 
         // Aqui, como o campo é aberto, assumimos o cálculo direto.
      }

      const taxImp = preco * (imposto / 100);
      const lucro = preco - custo - taxTotal - taxImp;

      document.getElementById('resPreco').innerText = preco.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      document.getElementById('badgeLucro').innerText = `Lucro: ${lucro.toLocaleString('pt-BR',{style:'currency',currency:'BRL'})}`;
      document.getElementById('badgeLucro').style.background = lucro > 0 ? '#dcfce7' : '#fee2e2';
      document.getElementById('badgeLucro').style.color = lucro > 0 ? '#166534' : '#991b1b';
      document.getElementById('resTaxas').innerText = taxTotal.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      document.getElementById('resImposto').innerText = taxImp.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      document.getElementById('resCusto').innerText = custo.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      const rf = document.getElementById('rowFrete');
      rf.style.display = fSeller > 0 ? 'flex' : 'none';
      if(fSeller > 0) document.getElementById('resFrete').innerText=fSeller.toLocaleString('pt-BR',{style:'currency',currency:'BRL'});
      document.getElementById('results').style.display='block';
    }

    function generateLink(){ const n=document.getElementById('tokenName').value.toUpperCase()||"CLIENTE"; document.getElementById('finalLink').value=`${window.location.href.split('?')[0]}?token=${n}`; }
    function copyLink(){ const c=document.getElementById('finalLink'); c.select(); navigator.clipboard.writeText(c.value); alert("Copiado!"); }

    setPlatform('shopee');
  </script>
</body>
</html>